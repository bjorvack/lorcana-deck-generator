(self.webpackChunklorcana_deck_generator=self.webpackChunklorcana_deck_generator||[]).push([[745],{580:(e,t,s)=>{"use strict";var a=s(947),o=s(122);class n{constructor(){this.model=null,this.vocabSize=0,this.maxLen=60,this.embeddingDim=64,this.lstmUnits=128}async loadModel(e){this.model=await o.O0W(e);const t=this.model.getLayer("card_embedding");this.vocabSize=t.inputDim,this.embeddingDim=t.outputDim,console.log(`Model loaded. Vocab: ${this.vocabSize}, Embedding: ${this.embeddingDim}`)}async predict(e){if(!this.model)throw new Error("Model not loaded");const t=new Array(this.maxLen).fill(0);for(let s=0;s<Math.min(e.length,this.maxLen);s++)t[s]=e[s];const s=o.KtR([t],[1,this.maxLen],"int32"),a=this.model.predict(s),n=await a.data();return s.dispose(),a.dispose(),n}async train(e,t,s,a,o){console.warn("Training in frontend is not fully implemented/optimized.")}prepareData(e,t){return{}}async predict(e){if(!this.model)return null;const t=Math.max(0,this.maxLen-e.length),s=new Array(this.maxLen).fill(0);for(let a=0;a<Math.min(e.length,this.maxLen);a++)s[t+a]=e[a];const a=o.KtR([s],[1,this.maxLen],"int32"),n=this.model.predict(a),i=await n.data();return a.dispose(),n.dispose(),i}async saveModel(e){this.model&&(e.startsWith("file://")||(e=`file://${e}`),await this.model.save(e))}async loadModel(e){this.model=await o.O0W(e),this.model.compile({optimizer:"adam",loss:"sparseCategoricalCrossentropy",metrics:["accuracy"]}),this.model.inputs&&this.model.inputs.length>0&&(this.featureDim=this.model.inputs[0].shape[2]),this.model.inputs&&this.model.inputs.length>1&&(this.maxNameTokens=this.model.inputs[1].shape[2]),this.model.inputs&&this.model.inputs.length>2&&(this.maxKeywordsTokens=this.model.inputs[2].shape[2]),this.model.inputs&&this.model.inputs.length>3&&(this.maxInkTokens=this.model.inputs[3].shape[2]),this.model.inputs&&this.model.inputs.length>4&&(this.maxClassTokens=this.model.inputs[4].shape[2]),this.model.inputs&&this.model.inputs.length>5&&(this.maxTypeTokens=this.model.inputs[5].shape[2]),this.model.inputs&&this.model.inputs.length>6&&(this.maxBodyTokens=this.model.inputs[6].shape[2]),this.model.summary()}}class i{constructor(){this.tokenToIndex={"<PAD>":0,"<UNK>":1},this.indexToToken={0:"<PAD>",1:"<UNK>"},this.vocabularySize=2,this.maxNameTokens=5,this.maxKeywordsTokens=10,this.maxInkTokens=2,this.maxClassTokens=5,this.maxTypeTokens=3,this.maxBodyTokens=30,this.allCardNames=[]}load(e){this.tokenToIndex=e.tokenToIndex,this.indexToToken=e.indexToToken,this.vocabularySize=e.vocabularySize,this.maxNameTokens=e.maxNameTokens||5,this.maxKeywordsTokens=e.maxKeywordsTokens||10,this.maxInkTokens=e.maxInkTokens||2,this.maxClassTokens=e.maxClassTokens||5,this.maxTypeTokens=e.maxTypeTokens||3,this.maxBodyTokens=e.maxBodyTokens||30,this.allCardNames=e.allCardNames||[],console.log(`Vocabulary loaded (${this.vocabularySize} tokens)`)}cleanText(e){if(!e)return"";let t=e.toLowerCase();return t=t.replace(/\{e\}/g," exert "),t=t.replace(/[^a-z0-9\s+\{\}]/g,""),t.trim()}extractTextTokens(e,t){const s=[];let a=this.cleanText(e);t.forEach((e=>{a.includes(e)&&(s.push(e),a=a.replace(new RegExp(e,"g")," "))}));const o=a.split(/\s+/).map((e=>e.trim())).filter((e=>e.length>2||"+"===e||"{"===e||"}"===e));return s.push(...o),s}cardToTextIndices(e){const t=[],s=this.cleanText(e.name);s&&(void 0!==this.tokenToIndex[s]?t.push(this.tokenToIndex[s]):t.push(this.tokenToIndex["<UNK>"]));const a=[];e.keywords&&Array.isArray(e.keywords)&&e.keywords.forEach((e=>{const t=this.cleanText(e),s=this.tokenToIndex[t]||this.tokenToIndex["<UNK>"];a.push(s)}));const o=[];if(e.ink){const t=this.cleanText(e.ink),s=this.tokenToIndex[t]||this.tokenToIndex["<UNK>"];o.push(s)}const n=[];e.classifications&&Array.isArray(e.classifications)&&e.classifications.forEach((e=>{const t=this.cleanText(e),s=this.tokenToIndex[t]||this.tokenToIndex["<UNK>"];n.push(s)}));const i=[];e.types&&Array.isArray(e.types)?e.types.forEach((e=>{const t=this.cleanText(e),s=this.tokenToIndex[t]||this.tokenToIndex["<UNK>"];i.push(s)})):e.type&&Array.isArray(e.type)&&e.type.forEach((e=>{const t=this.cleanText(e),s=this.tokenToIndex[t]||this.tokenToIndex["<UNK>"];i.push(s)}));const r=[];let l=e.sanitizedText;return!l&&e.text&&(l=e.text.toLowerCase().replace(/\([^)]+\)/g,"").replace(/\(|\)/g,"").trim()),l&&this.extractTextTokens(l,this.allCardNames).forEach((e=>{const t=this.tokenToIndex[e]||this.tokenToIndex["<UNK>"];r.push(t)})),{name:this.padOrTruncate(t,this.maxNameTokens),keywords:this.padOrTruncate(a,this.maxKeywordsTokens),ink:this.padOrTruncate(o,this.maxInkTokens),classifications:this.padOrTruncate(n,this.maxClassTokens),types:this.padOrTruncate(i,this.maxTypeTokens),text:this.padOrTruncate(r,this.maxBodyTokens)}}padOrTruncate(e,t){if(e.length>=t)return e.slice(0,t);const s=[...e];for(;s.length<t;)s.push(0);return s}}class r{constructor(){this.model=null,this.featureDim=0,this.thresholds={excellent:.85,good:.7,fair:.5,poor:0}}async loadModel(e){this.model=await o.O0W(e),this.model.compile({optimizer:"adam",loss:"binaryCrossentropy",metrics:["accuracy"]}),this.model.inputs&&this.model.inputs.length>0&&(this.featureDim=this.model.inputs[0].shape[1]),console.log("Validation model loaded successfully")}async evaluate(e){if(!this.model)return null;const t=e[0],s=Math.round(20*t);if(s<10)return console.log(`[RULE] Low diversity detected: ${s} unique cards - returning 0.0`),0;const a=e.slice(20,26).filter((e=>e>.001));if(a.length>2)return console.log(`[RULE] Too many inks detected: ${a.length} - returning 0.0`),0;e[5]>0&&console.log("[WARNING] Cards with > 4 copies detected. This may be valid for specific cards (e.g. Dalmation Puppy).");const n=o.KtR([e]),i=this.model.predict(n),r=(await i.data())[0];return n.dispose(),i.dispose(),r}async evaluateWithBreakdown(e){const t=await this.evaluate(e),s=this.analyzeFeatures(e);return{score:t,grade:this.getGrade(t),message:this.getMessage(t),breakdown:s}}analyzeFeatures(e){const t=[],s=e[0],a=Math.round(20*s);a<12?t.push({issue:"Low Card Diversity",severity:"high",message:`Only ~${a} unique cards. Aim for 15-20 for a versatile deck.`}):a>25&&t.push({issue:"Too Many Unique Cards",severity:"medium",message:`~${a} unique cards. Consistency might suffer.`});const o=e[1];o>.3&&t.push({issue:"High singleton count",severity:"high",message:`${Math.round(100*o)}% of unique cards have only 1 copy`}),e[5]>0&&t.push({issue:"Excessive Card Copies",severity:"medium",message:"Some cards have > 4 copies. Ensure this is valid (e.g. Dalmation Puppy)."}),e[2]>.4&&t.push({issue:"Lack of Focus",severity:"low",message:"High number of 2-copy cards. Commit to 4 copies for your best cards."});const n=e.slice(20,26).filter((e=>e>.001));if(n.length>2)t.push({issue:"Illegal Deck",severity:"critical",message:`Deck uses ${n.length} inks. Maximum allowed is 2.`});else if(2===n.length){const e=[...n].sort(((e,t)=>e-t))[0],s=Math.round(60*e);s<6&&t.push({issue:"Unreliable Ink Splash",severity:"medium",message:`Secondary ink has only ~${s} cards. You might struggle to find ink for them.`})}const i=e[26];i<.6?t.push({issue:"Risk of Bricking",severity:"high",message:`Only ${Math.round(100*i)}% cards are inkable. Aim for >75% to ensure you can play cards.`}):i<.75&&t.push({issue:"Low Inkable Count",severity:"medium",message:`${Math.round(100*i)}% inkable. You might miss land drops occasionally.`});const r=e[16];r<.5&&t.push({issue:"Low Character Count",severity:"high",message:`Only ${Math.round(100*r)}% characters. You need characters to quest and challenge.`});const l=e.slice(6,16);l.slice(0,3).reduce(((e,t)=>e+t),0)<.2&&t.push({issue:"Slow Start",severity:"high",message:"Very few 1-3 cost cards. You risk falling behind early."}),l.slice(4).reduce(((e,t)=>e+t),0)<.15&&t.push({issue:"Lack of Finishers",severity:"medium",message:"Few high-cost cards. You might run out of steam in the late game."});const d=1-i,c=Math.round(60*d);c>16&&t.push({issue:"Too Many Uninkables",severity:"high",message:`~${c} uninkable cards. This will cause consistency issues.`}),e[37]<.15&&t.push({issue:"Low Tribal Synergy",severity:"medium",message:"Cards do not seem to share strong thematic or mechanical links (Classifications)."});const h=e.length-32,u=e.slice(h).reduce(((e,t)=>e+t),0)/32,m=Math.max(0,1-5*u);return m<.4?t.push({issue:"Low Semantic Synergy",severity:"medium",message:`Cards have very different text/effects (Score: ${(100*m).toFixed(0)}%). They might not work well together.`}):m>.7&&t.push({issue:"High Semantic Synergy",severity:"info",message:`Cards share similar text/effects (Score: ${(100*m).toFixed(0)}%). Strong mechanical consistency.`}),t}calculateVariance(e){const t=e.reduce(((e,t)=>e+t),0)/e.length;return e.map((e=>Math.pow(e-t,2))).reduce(((e,t)=>e+t),0)/e.length}getGrade(e){return e>=this.thresholds.excellent?"A":e>=this.thresholds.good?"B":e>=this.thresholds.fair?"C":"D"}getMessage(e){return e>=this.thresholds.excellent?"This deck looks authentic!":e>=this.thresholds.good?"This deck looks realistic with minor issues":e>=this.thresholds.fair?"This deck has some unrealistic patterns":"This deck seems randomly generated"}}class l{constructor(){this.cardApi=new a.A,this.model=new n,this.textEmbedder=new i,this.validationModel=new r,this.validationModelLoaded=!1,this.cards=[],this.cardMap=new Map,this.indexMap=new Map}getCardKey(e,t){return t?`${e} - ${t}`:e}async loadCards(){return 0===this.cards.length&&(this.cards=await this.cardApi.getCards(),this.cards.forEach((e=>{const t=this.getCardKey(e.name,e.version);if(!this.cardMap.has(t)){const s=this.cardMap.size;this.cardMap.set(t,s),this.indexMap.set(s,e)}}))),this.cards}async loadModel(e){await this.loadCards();try{const e=await fetch("training_data/vocabulary.json");if(e.ok){const t=await e.json();this.textEmbedder.load(t)}else console.error("Failed to load vocabulary.json")}catch(e){console.error("Error loading vocabulary:",e)}await this.model.loadModel(e)}async predict(e,t=!0,s=[]){const a=[];e.forEach((e=>{let t=null;if(e.includes(" - ")){const s=e.split(" - "),a=s[0].trim(),o=s.slice(1).join(" - ").trim(),n=this.getCardKey(a,o);this.cardMap.has(n)&&(t=this.cardMap.get(n))}if(null===t){const s=e.trim().toLowerCase();for(const[e,a]of this.cardMap.entries())if(e.toLowerCase().startsWith(s)){t=a;break}}null!==t&&a.push(t+1)}));const o=new Map,n=new Set;a.forEach((e=>{const t=e-1;o.set(t,(o.get(t)||0)+1);const s=this.indexMap.get(t);s&&s.ink&&n.add(s.ink)}));const i=await this.model.predict(a),r=this.boostSingletons(i,a,2.5),l=this.getAdaptiveTemperature(a.length),d=this.sampleTopP(r,l,.9),c=Array.from(r).map(((e,t)=>({index:t,prob:e}))).sort(((e,t)=>t.prob-e.prob)),h=[d,...c.map((e=>e.index)).filter((e=>e!==d))];for(const e of h){const a=this.indexMap.get(e);if(a&&!(t&&"legal"!==a.legality||(o.get(e)||0)>=(a.maxAmount||4))){if(s.length>0&&!(a.inks||(a.ink?[a.ink]:[])).every((e=>s.includes(e))))continue;if(!(n.size>=2)||n.has(a.ink))return a}}return null}getAdaptiveTemperature(e){return e<=10?2:e<=40?1:.8}boostSingletons(e,t,s=2){const a=Float32Array.from(e),o=new Map;for(const e of t)o.set(e,(o.get(e)||0)+1);for(const[e,t]of o)1===t&&e<a.length&&(a[e]*=s);let n=0;for(let e=0;e<a.length;e++)n+=a[e];if(n>0)for(let e=0;e<a.length;e++)a[e]/=n;return a}sampleTopP(e,t=1,s=.9){const a=Array.from(e).map(((e,s)=>({prob:Math.pow(Math.max(e,1e-10),1/t),index:s}))),o=a.reduce(((e,t)=>e+t.prob),0);a.forEach((e=>e.prob/=o)),a.sort(((e,t)=>t.prob-e.prob));let n=0;const i=[];for(const e of a)if(n+=e.prob,i.push(e),n>=s)break;0===i.length&&i.push(a[0]);const r=i.reduce(((e,t)=>e+t.prob),0),l=Math.random()*r;let d=0;for(const e of i)if(d+=e.prob,l<=d)return e.index;return i[i.length-1].index}getInitialDeckStats(){return{totalCards:0,inkableCount:0,costCounts:[0,0,0,0,0,0,0,0,0,0],inkableCostCounts:[0,0,0,0,0,0,0,0,0,0],typeCounts:{character:0,action:0,item:0,location:0},inkCounts:{Amber:0,Amethyst:0,Emerald:0,Ruby:0,Sapphire:0,Steel:0}}}updateDeckStats(e,t){e.totalCards++,t.inkwell&&e.inkableCount++;let s=Math.max(0,Math.min(t.cost-1,9));if(0===t.cost&&(s=0),e.costCounts[s]++,t.inkwell&&e.inkableCostCounts[s]++,t.ink&&(e.inkCounts[t.ink]||(e.inkCounts[t.ink]=0),e.inkCounts[t.ink]++),t.type){const s=t.type.toLowerCase();void 0!==e.typeCounts[s]&&e.typeCounts[s]++}}extractCardFeatures(e,t,s=0){const a=[];a.push(Math.min(e.cost,10)/10),a.push(e.inkwell?1:0),a.push(Math.min(e.lore||0,5)/5),a.push(Math.min(e.strength||0,10)/10),a.push(Math.min(e.willpower||0,10)/10),["Amber","Amethyst","Emerald","Ruby","Sapphire","Steel"].forEach((t=>{a.push(e.ink===t?1:0)}));const o=e.types&&e.types.length>0?e.types[0]:"";["Character","Action","Item","Location"].forEach((e=>{a.push(o===e?1:0)})),["Bodyguard","Reckless","Rush","Ward","Evasive","Resist","Challenger","Singer","Shift","Boost"].forEach((t=>{const s=`has${t}`;if(void 0!==e[s])a.push(e[s]?1:0);else{const s=e.keywords&&e.keywords.some((e=>e.includes(t)));a.push(s?1:0)}})),a.push(Math.min(e.resistAmount||0,10)/10),a.push(Math.min(e.challengerAmount||0,10)/10),a.push(Math.min(e.boostAmount||0,10)/10),a.push(Math.min(e.moveCost||0,10)/10),["Hero","Villain","Dreamborn","Storyborn","Floodborn"].forEach((t=>{a.push(e.classifications&&e.classifications.includes(t)?1:0)})),a.push(Math.min(s,4)/4);const n=Math.max(1,t.totalCards);return a.push(t.inkableCount/n),t.costCounts.forEach((e=>{a.push(e/n)})),Object.values(t.typeCounts).forEach((e=>{a.push(e/n)})),["Amber","Amethyst","Emerald","Ruby","Sapphire","Steel"].forEach((e=>{a.push((t.inkCounts[e]||0)/n)})),t.inkableCostCounts.forEach((e=>{a.push(e/n)})),a}getCardByName(e){let t=null;if(e.includes(" - ")){const s=e.split(" - "),a=s[0].trim(),o=s.slice(1).join(" - ").trim(),n=this.getCardKey(a,o);this.cardMap.has(n)&&(t=this.cardMap.get(n))}if(null===t){const s=e.trim().toLowerCase();for(const[e,a]of this.cardMap.entries())if(e.toLowerCase().startsWith(s)){t=a;break}}return null!==t?this.indexMap.get(t):null}async loadValidationModel(e){try{await this.validationModel.loadModel(e),this.validationModelLoaded=!0,console.log("Validation model loaded successfully")}catch(e){console.error("Failed to load validation model:",e),this.validationModelLoaded=!1}}computeCardEmbedding(e){const t=new Array(32).fill(0),s=[e.name||"",e.keywords?e.keywords.join(" "):"",e.classifications?e.classifications.join(" "):"",e.types?e.types.join(" "):"",e.ink||"",e.text||""].join(" ").toLowerCase();for(let e=0;e<s.length;e++)t[s.charCodeAt(e)%32]+=1;const a=Math.sqrt(t.reduce(((e,t)=>e+t*t),0));if(a>0)for(let e=0;e<32;e++)t[e]/=a;return t}extractDeckFeatures(e){const t=[],s=[];e.forEach((e=>{const t=this.getCardKey(e.name,e.version);this.cardMap.has(t)&&s.push(this.cardMap.get(t))}));const a=[0,0,0,0,0],o=new Map;for(const e of s)o.set(e,(o.get(e)||0)+1);const n=o.size;t.push(n/20);for(const e of o.values())1===e?a[0]++:2===e?a[1]++:3===e?a[2]++:4===e?a[3]++:a[4]++;const i=[...o.keys()].length;a.forEach(((e,s)=>t.push(e/Math.max(1,i))));const r=Array(10).fill(0);let l=0,d=s.length;const c={character:0,action:0,item:0,location:0},h={Amber:0,Amethyst:0,Emerald:0,Ruby:0,Sapphire:0,Steel:0},u={Ward:0,Evasive:0,Bodyguard:0,Resist:0,Singer:0,Shift:0,Reckless:0,Challenger:0,Rush:0},m=new Map;for(const e of s){const t=this.indexMap.get(e);if(t){if(r[Math.min(t.cost-1,9)]++,t.inkwell&&l++,t.types&&t.types.length>0){const e=t.types[0].toLowerCase();void 0!==c[e]&&c[e]++}t.ink&&void 0!==h[t.ink]&&h[t.ink]++;for(const e of Object.keys(u))(t[`has${e}`]||t.keywords&&t.keywords.some((t=>t.includes(e))))&&u[e]++;if(t.classifications)for(const e of t.classifications)m.set(e,(m.get(e)||0)+1)}}r.forEach((e=>t.push(e/d))),Object.values(c).forEach((e=>t.push(e/d))),Object.values(h).forEach((e=>t.push(e/d))),t.push(l/d),Object.values(u).forEach((e=>t.push(e/d))),t.push(m.size/10);const p=m.size>0?Array.from(m.values()).reduce(((e,t)=>e+t),0)/m.size/d:0;t.push(p);const g=[];for(const e of s){const t=this.indexMap.get(e);t&&g.push(this.computeCardEmbedding(t))}if(0===g.length){const e=new Array(96).fill(0);return t.push(...e),t}const f=32,y=new Array(f).fill(0),k=new Array(f).fill(-1/0);for(const e of g)for(let t=0;t<f;t++)y[t]+=e[t],k[t]=Math.max(k[t],e[t]);for(let e=0;e<f;e++)y[e]/=g.length;const v=new Array(f).fill(0);for(const e of g)for(let t=0;t<f;t++){const s=e[t]-y[t];v[t]+=s*s}for(let e=0;e<f;e++)v[e]/=g.length;return t.push(...y),t.push(...k),t.push(...v),t}async validateDeck(e){if(!this.validationModelLoaded)return console.warn("Validation model not loaded"),null;if(!e||e.length<60)return{score:0,grade:"D",message:"Deck must have 60 cards",breakdown:[]};const t=this.extractDeckFeatures(e),s=new Set(e.map((e=>this.getCardKey(e.name,e.version))));console.log("Validation features:",{featureCount:t.length,uniqueCardCount:s.size,singletonRatio:t[0],twoOfRatio:t[1],threeOfRatio:t[2],fourOfRatio:t[3],moreThanFourRatio:t[4],manaCurvePeak:Math.max(...t.slice(5,15)),characterRatio:t[15],inkableRatio:t[25],synergyScore:t[36],allFeatures:t});const a=await this.validationModel.evaluateWithBreakdown(t);return console.log("Validation result:",a),a}}var d=s(238),c=s(795),h=s(814),u=s(479),m=s(844);document.addEventListener("DOMContentLoaded",(async()=>{const e=new l,t=document.getElementById("generate-deck-btn"),s=document.getElementById("test-deck-btn"),a=document.getElementById("clear-deck-btn"),o=document.querySelector('[data-role="chart"]'),n=document.getElementById("legal-only"),i=new d.A(o);let r,p,g,f,y=[],k=[];f=new m.A;const v=document.querySelector('[data-role="deck"]');p=new h.A(v,{onRemove:e=>{const t=y.findIndex((t=>t.id===e));-1!==t&&(y.splice(t,1),w(),r.refresh())},onAdd:()=>r.show(),onCardClick:e=>f.show(e.image,e.name),isEditable:!0,showAddPlaceholder:!0}),g=new u.A(document.querySelector('[data-role="ink-selector"]'),{onChange:e=>{k=e;const t=y.filter((e=>k.includes(e.ink)||x(e,k)));t.length!==y.length&&(y=t,w()),r&&r.refresh()}}),w();try{console.log("Loading AI model..."),await e.loadModel("training_data/deck-generator-rl/model.json"),console.log("Model loaded successfully!"),r=new c.A(e.cards,document.querySelector("[data-role=card-select]"),(e=>function(e){if(y.length>=60)return void alert("Deck is full (60 cards).");y.filter((t=>t.title===e.title)).length>=e.maxAmount?alert(`Cannot add more than ${e.maxAmount} copies of this card.`):(y.push(e),w(),r.refresh())}(e)),{filter:e=>!(k.length>0&&!k.includes(e.ink)&&!x(e,k))&&y.filter((t=>t.title===e.title)).length<e.maxAmount,renderButtonText:e=>{const t=y.filter((t=>t.title===e.title)).length;return t>=e.maxAmount?`Max Reached <small>(${t}/${e.maxAmount})</small>`:`Add Card <small>(${t}/${e.maxAmount})</small>`}}),t.disabled=!1;try{console.log("Loading validation model..."),await e.loadValidationModel("training_data/deck-validator-model/model.json"),console.log("Validation model loaded!")}catch(e){console.warn("Validation model not available:",e)}}catch(e){console.error("Failed to load model:",e),alert("Failed to load AI model. Please refresh the page.")}function x(e,t){return!(2!==t.length||!e.inks)&&t.includes(e.inks[0])&&t.includes(e.inks[1])}function w(){p.render(y,k),s.classList.remove("hidden"),y.length<60&&s.classList.add("hidden"),y.length>0?i.renderChart(y):i.renderChart([]),async function(){console.log("updateValidationScore called, deck length:",y.length);const t=document.querySelector('[data-role="validation-score"]');if(t)if(y.length<60)t.innerHTML=`\n                <div class="validation-card">\n                    <div class="validation-header">\n                        <h3>Deck Realism</h3>\n                        <span class="validation-grade grade-empty">-</span>\n                    </div>\n                    <div class="validation-message">Add ${60-y.length} more cards</div>\n                </div>\n            `;else try{console.log("Calling manager.validateDeck...");const s=await e.validateDeck(y);if(console.log("Validation result received:",s),!s)return void(t.innerHTML="");const a=Math.round(100*s.score),o="A"===s.grade?"grade-a":"B"===s.grade?"grade-b":"C"===s.grade?"grade-c":"grade-d";let n="";s.breakdown&&s.breakdown.length>0&&(n='<div class="validation-breakdown">',n+="<h4>Analysis:</h4>",n+="<ul>",s.breakdown.forEach((e=>{let t="severity-medium";"high"===e.severity&&(t="severity-high"),"info"===e.severity&&(t="severity-info"),n+=`<li class="${t}"><strong>${e.issue}:</strong> ${e.message}</li>`})),n+="</ul></div>"),t.innerHTML=`\n                <div class="validation-card">\n                    <div class="validation-header">\n                        <h3>Deck Realism</h3>\n                        <span class="validation-grade ${o}">${s.grade}</span>\n                    </div>\n                    <div class="validation-score">${a}%</div>\n                    <div class="validation-message">${s.message}</div>\n                    ${n}\n                </div>\n            `}catch(e){console.error("Error in updateValidationScore:",e),t.innerHTML=`\n                <div class="validation-card">\n                    <div class="validation-message" style="color: #ef4444;">\n                        Error loading validation: ${e.message}\n                    </div>\n                </div>\n            `}else console.warn("Validation container not found")}()}t.addEventListener("click",(async()=>{t.disabled=!0;const s=n.checked;for(;y.length<60;){const t=y.map((e=>e.version?`${e.name} - ${e.version}`:e.name)),a=await e.predict(t,s,k);if(!a||"string"==typeof a){console.warn("No valid prediction:",a);break}y.push(a),w(),await new Promise((e=>setTimeout(e,10)))}t.disabled=!1})),a.addEventListener("click",(()=>{y=[],w(),s.classList.add("hidden")})),s.addEventListener("click",(()=>{window.open(function(){const e=Math.random().toString(36).substring(7);let t=`AI Generated Deck: ${k[0]} - ${k[1]} - ${e}`;t=encodeURIComponent(t);let s="";const a=[...new Set(y.map((e=>e.title)))];for(const e of a){const t=y.filter((t=>t.title===e)).length;s+=`${e}$${t}|`}return`https://inktable.net/lor/import?svc=dreamborn&name=${t}&id=${btoa(s)}`}(),"_blank")}))}))},817:()=>{},590:()=>{},530:()=>{},108:()=>{},551:()=>{},234:()=>{}},e=>{e.O(0,[839,122,452],(()=>e(e.s=580))),e.O()}]);